pipeline {
    agent any

    stages {
        stage('Build') {
            steps {
                echo "Compiling..."

                sh '''
                    cd simple-akka-http-k8s
                    ls

                    "${tool name: 'jen_sbt', type: 'org.jvnet.hudson.plugins.SbtPluginBuilder$SbtInstallation'}/bin/sbt orderServiceCompile"
                   '''
            }
        }
        stage('Unit Test') {
            steps {
                echo "Testing..."

                sh '''
                    cd simple-akka-http-k8s
                    ls

                    "${tool name: 'jen_sbt', type: 'org.jvnet.hudson.plugins.SbtPluginBuilder$SbtInstallation'}/bin/sbt orderServiceTest"
                   '''
            }
        }
        stage('Docker Build and Push') {
            steps {
                echo "Building Docker Image..."

                script {
                    docker.withTool('docker') {
                        def orderServiceImage = docker.build('vi_kas.github.io/orderService:latest', 'simple-akka-http-k8s/orderService/target/docker')
                        orderServiceImage.push()
                    }
                }
            }
        }
    }
}